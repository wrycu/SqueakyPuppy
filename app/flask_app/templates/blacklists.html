{%- from "_formhelper.html" import render_form, success_header, error_header, title_content, footer -%}
<button class="ui basic button blacklists">
    <i class="world icon"></i>
    Blacklist domain
</button>
<table class="ui celled table">
<thead>
    <tr>
        <th>Name</th>
    </tr>
</thead>
<tbody>
    {%- for row in blacklists -%}
        <tr>
            <td>
                <i class="icon link trash delete_blacklist" data-id="{{ row['id'] }}"></i>
                {{ row['domain'] }}
            </td>
        </tr>
    {%- endfor -%}
</tbody>
</table>

<script>
    $(function () {
        $('.ui.dropdown').dropdown();
        $('.ui.modal.blacklists').modal({
            onApprove : function() {
                return false;
            }
        }).modal('attach events', '.button.blacklists', 'show');

        $('#create_blacklist').form({
            fields: {
                name      : 'empty',
                assignees : ['minCount[1]', 'empty'],
            }
        });

        $('#create_blacklist').api({
            action: 'create blacklist',
            method: 'POST',
            serializeForm: true,
            onSuccess: function() {
                $('#create_blacklist').trigger('reset');
                $('.ui.dropdown').dropdown('clear');
                $('.ui.modal.blacklists').modal('hide');
                $('div.a_message').html('{{ success_header|safe }}Success{{ title_content|safe }}Blacklist added!{{ footer|safe }}');
                $('#tab_blacklists').click()
                $('.message .close').on('click', function() {
                    $(this).closest('.message').transition('fade');
                });
            },
            onError: function() {
                return false;
            },
        });

        $('.delete_blacklist').api({
            action: 'delete blacklist',
            method: 'DELETE',
            serializeForm: true,
            onSuccess: function() {
                $('div.a_message').html('{{ success_header|safe }}Success{{ title_content|safe }}Blacklist deleted!{{ footer|safe }}');
                $('#tab_blacklists').click()
                $('.message .close').on('click', function() {
                    $(this).closest('.message').transition('fade');
                });
            },
            onError: function(errorMessage) {
                $('div.a_message').html('{{ error_header|safe }} Error{{ title_content|safe }}' + errorMessage + '{{ footer|safe }}');
                $('.message .close').on('click', function() {
                    $(this).closest('.message').transition('fade');
                });
            },
        });

        $('.edit_blacklist').api({
            action: 'modify blacklist',
            method : 'GET',
            dataType: 'html',
            stateContext : '#edit_blacklist_container',
            onSuccess: function(response) {
                $('.ui.modal.edit_blacklist').html("");
                $('#edit_blacklist_container').html(response);
                $('.ui.dropdown').dropdown();
                $('#edit_blacklist_modal').modal({
                    onApprove : function() {
                        return false;
                    },
                }).modal('show');
                $('#edit_blacklist').api({
                    action: 'modify blacklist',
                    method: 'POST',
                    serializeForm: true,
                    onSuccess: function() {
                        $('.ui.modal.edit_blacklist').modal('hide');
                        $('div.a_message').html('{{ success_header|safe }}Success{{ title_content|safe }}Domain blacklist updated!{{ footer|safe }}');
                        $('#tab_blacklists').click()
                        $('.message .close').on('click', function() {
                            $(this).closest('.message').transition('fade');
                        });
                    },
                    onError: function() {
                        return false;
                    },
                    urlData: {
                        id:  $('#id').val()
                    },
                });
            },
        });
    });
</script>

<div class="ui modal blacklists">
    <div class="header">
        Create new Blacklist
    </div>
    <div class="content">
        <p>
            {{ render_form(blacklist_form, "create_blacklist") }}
        </p>
    </div>
    <div class="actions">
        <input type="submit" value="Create" form="create_blacklist" class="ui positive button" id="btn_create_blacklist" formmethod="post">
        <div class="ui button cancel">Cancel</div>
    </div>
</div>

<div id="edit_blacklist_container"></div>
<div id="view_blacklist_container"></div>